{% extends 'new/public.html' %}


{% block topfile %}
<link rel="shortcut icon" href="{{ url_for('static', filename='images/bitbug_favicon.ico') }}"/>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/public.css') }}"/>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/sub.css') }}"/>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/iconfont.css') }}"/>
<link rel="stylesheet" type="{{ url_for('static', filename='text/css" href="css/calendar.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='c3/c3.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}"/>

<link rel="stylesheet" href="{{ url_for('static', filename='data1/css/lq.datetimepick.css') }}"/>
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery-1.7.2.js') }}"></script>
<script type="text/javascript" src="{{url_for('static', filename='js/paging.js')}}" ></script>
<style>

    @font-face {font-family: "iconfont";
        src: url('iconfont.eot?t=1534062512230'); /* IE9*/
        src: url('iconfont.eot?t=1534062512230#iefix') format('embedded-opentype'), /* IE6-IE8 */
        url('data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAU0AAsAAAAAB5gAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kf3Y21hcAAAAYAAAABdAAABhplsBr5nbHlmAAAB4AAAAWgAAAGEr8Az+mhlYWQAAANIAAAALwAAADYSS2VdaGhlYQAAA3gAAAAcAAAAJAfeA4RobXR4AAADlAAAAAwAAAAMC+kAAGxvY2EAAAOgAAAACAAAAAgAdgDCbWF4cAAAA6gAAAAfAAAAIAESAF1uYW1lAAADyAAAAUUAAAJtPlT+fXBvc3QAAAUQAAAAIgAAADPefO1zeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2Bk/sE4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVDzjZW7438AQw9zA0AAUZgTJAQAkUwx5eJzFkMENgDAMAy9t6QPRPXgwEC/m6MRdo5hQHkxQS44Vx1KiAAsQxUNMYBfGg1OuuR9Z3U+eyVIjUFvpXf2nimiWXYNKZhps3uo/Nq/76PQV6qBObOUl4QZudwvDAAAAeJw1j71OwlAcxf//W+7lu0A/oXy1tPSqKImllEQiMrhoHEycXAw+gK4sDl1MHBx8BGNMfAnCI/AADEYjPAbVauLJyRlOfsM5QAG+P4WZUAYZtmAfjuEcAFkHWyKpo8X9LumgalFVV0SB29xK2q2ucIh6iymaF/iuzpKsgCI2sGd5Ae8Sjn1/RIboaXXEStW4kNo1SXjCTJk37qNT8oJq064VRnvRye6R4plyapqTpIokPaYYpSlCEgURb3QtTdMZFr3SgqHOmtukibkKN84u82ZVun7wb+ttPY0YhihXTfHtqGSUYt8ZmixVksV8qmzkbUfB6SpblnN19wtiJeKvYQKEELKggwU7ANQFHsBAA50BH+Ggi1zEZAPlXqmn2v1eyY4rP/A0hZHiOlpSiu56gTXGotX7fEPpZv6XV8/jj/F4UnWcwHFChrXFGl1Ko+V6Ea0O/qk4yTAKTRMnE/wlAyee9QPkiE5meJxjYGRgYABiY0s+13h+m68M3CwMIHB9msAGBP2/gYWBuQHI5WBgAokCAO3HCNoAeJxjYGRgYG7438AQw8IAAkCSkQEVMAMARwkCbAQAAAAD6QAABAAAAAAAAAAAdgDCeJxjYGRgYGBmCGRgZQABJiDmAkIGhv9gPgMAEPcBcAB4nGWPTU7DMBCFX/oHpBKqqGCH5AViASj9EatuWFRq911036ZOmyqJI8et1ANwHo7ACTgC3IA78EgnmzaWx9+8eWNPANzgBx6O3y33kT1cMjtyDRe4F65TfxBukF+Em2jjVbhF/U3YxzOmwm10YXmD17hi9oR3YQ8dfAjXcI1P4Tr1L+EG+Vu4iTv8CrfQ8erCPuZeV7iNRy/2x1YvnF6p5UHFockikzm/gple75KFrdLqnGtbxCZTg6BfSVOdaVvdU+zXQ+ciFVmTqgmrOkmMyq3Z6tAFG+fyUa8XiR6EJuVYY/62xgKOcQWFJQ6MMUIYZIjK6Og7VWb0r7FDwl57Vj3N53RbFNT/c4UBAvTPXFO6stJ5Ok+BPV8bUnV0K27LnpQ0kV7NSRKyQl7WtlRC6gE2ZVeOEXpc0Yk/KGdI/wAJWm7IAAAAeJxjYGKAAC4G7ICZkYmRmZGFgbGCtSSzOCOTgQEAEj4CuwAA') format('woff'),
        url('iconfont.ttf?t=1534062512230') format('truetype'), /* chrome, firefox, opera, Safari, Android, iOS 4.2+*/
        url('iconfont.svg?t=1534062512230#iconfont') format('svg'); /* iOS 4.1- */
    }

    .iconfont {
        font-family:"iconfont" !important;

        font-style:normal;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .icon-tishi:before { content: "\e60d"; }

    .right-bottom{
        margin-top: 20px;
    }

    /*.check_all{*/
    /*margin-left: 44%;*/
    /*}*/
    /*@media screen and (max-width: 1450px){*/
    /*.check_all{*/
    /*margin-left: 41%;*/
    /*}*/
    /*}*/
    /*@media screen and (max-width: 1700px){*/
    /*.check_all{*/
    /*margin-left: 43%;*/
    /*}*/
    /*}*/

    .delete_btn{

        cursor: pointer;
        visibility: hidden;

    }


    .mirror-box {
        display: block;
        width: 100%;
        min-height: 500px;
    }

    .mirror-inerbox {
        display: block;
        width: 100%;
        height: 100%;
        padding: 20px;
    }



    .m-bdr {
        border-bottom: 1px solid #d9dce1;

    }
    .mirror-list-box{
        display: block;
        width: 100%;
        min-height: 400px;
        font-family: '宋体';
    }
    .mirror-list-box ul{
        display: block;
        width: 100%;
    }
    .mirror-list-box ul li{
        display: inline-block;
        width: 20%;
        text-align: center;
    }
    .mirror-name,.mirror-list{
        display: block;
        width: 100%;
    }
    .mirror-name{
        height: 50px;
        line-height: 50px;
        color: #999;
    }
    .mirror-list ul{
        height: 40px;
        line-height: 40px;
        color: #2c3850;
    }
    .clone-box{
        display: none;
    }
    .mirror-name li:nth-child(1){
        width: 10%;
    }
    .mirror-list ul li:nth-child(1){
        width:10%;
    }
    .mirror-name span {
        display: inline-block;
        margin: 0;
        padding: 0;
        font-family: "微软雅黑";
        font-size: 14px;
        font-weight: 200;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
    }

    .project-name{
        color: #1e90ff;
    }



    .w-100{
        width: 100%;
    }
    #page a {
        min-width: 30px;
        height: 28px;
        border: 1px solid #dce0e0!important;
        text-align: center;
        margin: 0 4px;
        cursor: pointer;
        line-height: 28px;
        color: #666666;
        font-size: 13px;
        display: inline-block;
        font-family: '微软雅黑';
    }
    .page_box{text-align: center}
    #page{
        display: inline-block;
    }
    #page .totalPages,#page .totalSize{display: none;}
    #page a{padding: 0 5px;margin: 0 1px;}
    #page a:hover{color: white;
        background: #00b5b8;
    }
    #page .current{background: #00b5b8;
        color:white;
    }
</style>
{% with namespace = "/jobs" %}
{% set room = "job_management" %}
{% include 'socketio.html' %}
{% endwith %}
{% endblock topfile %}

{% block rightcontent %}













<div class="f-l title">
    <h1 class="f-l c-grayblue"> 镜像仓库 </h1>
    <span class="f-l c-gray"> Welcome back, {{request.cookies.username}} </span>
</div>

<div class="f-l sub-title bgc-white">
    <a href="{{ url_for('hyperai.views.index') }}" class="f-l c-gray c-aqua-h"><span class="f-l"> Home   </span><em
            class="f-l c-gray"> / </em></a>
    <a href="#" class="f-l c-gray c-aqua-h"><span class="f-l"> 镜像仓库 </span><em class="f-l c-gray">
        / </em></a>
</div>

<div class="f-l lis-d bgc-white">
    <div class="l-box create-project">
        <a href="#" class="f-l btn-2 bgc-Aqua c-white m-r25 bgc-red-h c-white-h btn_new_model"> 新建项目 </a>

    </div>

</div>



<!--警告弹窗-->
<style>
    .alert-box,.create-pj,.tishi-box{    z-index: 99998;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, .6);
        display: none;
    }
    .alert-div{
        width: 400px;
        height: 240px;
        background: white;
        margin: 0 auto;
        margin-top: 10%;
        position: relative;
    }
    .pj-div{
        display: block;
        width: 400px;
        height: 400px;
        position: fixed;
        top: 20%;
        left: 55%;
        margin-left: -275px;
        z-index: 99999;
        background-color: #fff;
    }
    .alert-div-nav,.pj-div-nav{
        height:40px;
        line-height: 40px;
    }
    .pj-div-nav a{
        display: inline-block;
        float: right;
    }
    .pj-div-nav i{
        width: 40px;
        text-align: center;
        color: #999999;
    }
    .pj-div-nav i:hover{
        color: #ff6376;
    }
    .pj-content{
        display: block;
        width:100%;
        min-height:200px;
        padding: 20px 30px;
    }
    .pj-content label{
        display: block;
        /*width: 100%;*/
        height: 20px;
        font-family: "宋体";
        line-height: 20px;
        font-size: 14px;
        color: #000000;
        margin-bottom: 5px;
    }
    .pj-name input{
        height: 30px;
        width: 100%;
        margin-bottom: 10px;
        padding: 0 5px;
    }
    .pj-access{
        margin-top: 20px;
    }
    /*.pj-access div{*/
    /*margin-left: 40px;*/
    /*font-size: 14px;*/
    /*font-family: '宋体';*/
    /*}*/
    .pj-access i{
        margin-left: 20px;
        display: inline-block;
        height: 20px;
        line-height: 20px;
        color: #00b5b8;
        font-weight: 500;
        cursor: pointer;
    }
    .tishi-info{
        position: relative;
        /* z-index: 100000; */
        background: black;
        width: 180px;
        left: 52%;
        opacity: 0.9;
        color: #ffffff;
        border-radius: 5px;
        height: 80px;
        padding: 5px;
        font-size: 12px;
        display: none;
    }


    .alert-div-content h3{height: 40px;
        line-height: 40px;
        text-align: center;
        margin-top: 35px;
    }
    .alert-btn,.pj-btn{height: 40px;
        text-align: center;
        position: absolute;
        bottom: 35px;
        width: 100%;
    }
    .alert-btn div,.pj-btn div{display: inline-block; }
    .alert-btn  h3,.pj-btn h3{
        height:40px;
        width: 100%;
        /*padding: 0 30px;*/
        line-height: 40px;
    }
    .alert-btn-no,.pj-btn-no{
        color: #2c3850;
        background: #d2e0e9;
        margin-right: 20px;
        width:100px;
    }
    .pj-btn-no{
        margin-right: 50px;
    }
    .alert-btn-yes,.pj-btn-yes{background: #00b5b8;
        color: white;
        width:100px;
    }
    .pj-btn-yes input{
        border: none;
        background: #00b5b8;
        height: 40px;
        line-height: 40px;
        width: 100px;
        font-size: 18px;
        color: #ffffff;
    }
    .hover-red:hover{color: white;
        background: #ff6376;
    }
</style>
<div class="alert-box">
    <div class="alert-div">
        <div class="alert-div-nav">
            <!--<i class="fz-24 iconfont f-r hover-red"> &#xe676; </i>-->
        </div>
        <div class="alert-div-content">
            <h3>确认删除？</h3>
        </div>
        <div class="alert-btn">
            <div class="alert-btn-no hover-red">
                <h3>取消</h3>
            </div>
            <div class="alert-btn-yes hover-red">
                <h3>确认</h3>
            </div>
        </div>
    </div>
</div>

<div class="tishi-box">
    <div class="alert-div">
        <div class="alert-div-nav">
            <!--<i class="fz-24 iconfont f-r hover-red"> &#xe676; </i>-->
        </div>
        <div class="alert-div-content">
            <h3>创建成功</h3>
        </div>
        <div class="alert-btn">

            <div class="alert-btn-yes hover-red">
                <h3>确定</h3>
            </div>
        </div>
    </div>
</div>

<div class="create-pj">
    <div class="pj-div">
        <div class="pj-div-nav">
            <a href="#"><i class=" iconfont f-r "> &#xe676; </i></a>
        </div>
        <div class="pj-content">
            <div class="pj-name">
                <label for="pjname" class="f-l">项目名称<em style="display:inline-block;margin-left:5px;color: red">*</em></label>
                <span class="f-l name_tishi" style="display: none;color: red;font-size: 14px;margin-left: 30px;"></span>
                <input type="text" id="pjname" style="width: 96%" />
            </div>
            <div class="pj-name">
                <label for="pj-manager" class="f-l">项目管理者</label>

                <select id="pj-manager" style="width: 100%;height: 34px;">
                </select>
            </div>
            <div class="pj-access">
                <label for="pjaccess" class="f-l">访问级别</label>
                <span style="font-family: '宋体';font-size: 14px;">公开</span>
                <div class="f-l" style="margin-left: 30px">
                    <input type="checkbox" id="pjaccess" style="width: 20px;height: 15px;margin-right: 5px;"/>
                </div>
                <i class="iconfont icon-tishi"></i>
                <div class="tishi-info">当项目设为公开后，任何人都有此项目下镜像的读权限。命令行用户不需要“docker login”就可以拉取此项目下的镜像。</div>

            </div>
        </div>
        <div class="pj-btn">
            <div class="pj-btn-no hover-red">
                <h3>取消</h3>
            </div>
            <div class="pj-btn-yes hover-red">
                <input type="button" value="确认" class="hover-red">
            </div>
        </div>
    </div>
</div>

<!--克隆-->
<div class="clone-box">
    <ul class="f-l">
        <li class="f-l">
            <input type="checkbox" name="subcheck" class="check_each"/>
            <span class="  " style="height: 50px;line-height: 50px;margin-left: 10px;width: 20px;visibility: hidden;">
                    <i class="fz-20 iconfont"> &#xe61c; </i>
                </span>
        </li>
        <li class="f-l project-name" style="cursor: pointer;">hyperai_cloud</li>
        <li class="f-l">1</li>
        <li class="f-l">3</li>
        <li class="f-l">2018-08-08 13:45:03</li>
        <p class="f-l" style="display: none;"></p>
    </ul>

</div>



<div class="lis-c bgc-white">
    <div class="mirror-inerbox f-l">
        <!--<div class="mirror-title f-l">
            <span class="f-l m-bdr">共享镜像</span>
            <span class="f-l">私有镜像</span>
        </div>-->
        <div class="f-l mirror-list-box">
            <div class="mirror-name f-l m-bdr">
                <ul class="f-l">
                    <li class="f-l">
                        <div style="width: 100%;height: 50px;margin-left: 0px;">
                            <input type="checkbox" class="check_all " style="height: 50px;"/>
                            <span class=" delete_btn " style="height: 50px;line-height: 50px;margin-left: 10px;">
                    <i class="fz-20 iconfont"> &#xe61c; </i>
                </span>

                        </div>
                    </li>
                    <li class="f-l">项目名称</li>
                    <li class="f-l">访问级别</li>
                    <li class="f-l">项目管理者</li>
                    <li class="f-l">创建时间</li>
                </ul>
            </div>
            <div class="mirror-list f-l">

            </div>
        </div>

        <div class="w-100 page_box f-l" style="margin-top: 80px;">
            <div  id="page">

            </div>
        </div>

    </div>


</div>






<script>
    //    页码
    var page=function (a) {
        $("#page").paging({
            pageNo:1,    //显示页面
            totalPage: a,   //总页数
            totalSize: 300,
            callback: function(num) {

                console.log('---------',num)

                $.ajax({
                    type:'POST',
                    url:'/sysmanager/load_project',
                    data:{'num':num},
                    success:function (e) {
                        console.log('-----------', e)
                        if (e.errmsg == 'error') {
                            $('.tishi-box').css('display','block')
                            $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
                        } else {

                            $('.mirror-list ul').remove()

                            for (var i = 0; i < e.project_list.length; i++) {
                                var year = new Date(e.project_list[i]['create_time']).getFullYear()
                                var month = new Date(e.project_list[i]['create_time']).getMonth() + 1
                                var date = new Date(e.project_list[i]['create_time']).getDate()
                                var hour = new Date(e.project_list[i]['create_time']).getHours();
                                var min = new Date(e.project_list[i]['create_time']).getMinutes();
                                var second = new Date(e.project_list[i]['create_time']).getSeconds();
                                if (month < 10) {
                                    month = '0' + month
                                }
                                if (date < 10) {
                                    date = '0' + date
                                }
                                if (hour < 10) {
                                    hour = '0' + hour
                                }
                                if (min < 10) {
                                    min = '0' + min
                                }
                                if (second < 10) {
                                    second = '0' + second
                                }

                                $('.clone-box ul').clone().appendTo('.mirror-list')
                                $('.mirror-list ul').eq(i).find('li').eq(1).html(e.project_list[i]['project_name'])
                                $('.mirror-list ul').eq(i).find('li').eq(2).html(e.project_list[i]['access_level'])
                                $('.mirror-list ul').eq(i).find('li').eq(3).html(e.project_list[i]['role_name'])
                                $('.mirror-list ul').eq(i).find('li').eq(4).html(year + '-' + month + '-' + date + ' ' + hour + ':' + min + ':' + second)
                                $('.mirror-list ul').eq(i).find('p').html(e.project_list[i]['project_id'])


                                if ($('.mirror-list ul').eq(i).find('li').eq(2).html() == 'true') {
                                    $('.mirror-list ul').eq(i).find('li').eq(2).html('公开')
                                } else if ($('.mirror-list ul').eq(i).find('li').eq(2).html() == 'false') {
                                    $('.mirror-list ul').eq(i).find('li').eq(2).html("私有")
                                }

                                // if($('.mirror-list ul').eq(i).find('li').eq(3).html() == 'projectAdmin'){
                                //     $('.mirror-list ul').eq(i).find('li').eq(3).html('项目管理员')
                                // }else if($('.mirror-list ul').eq(i).find('li').eq(3).html() == 'developer'){
                                //     $('.mirror-list ul').eq(i).find('li').eq(3).html('开发人员')
                                // }else{
                                //     $('.mirror-list ul').eq(i).find('li').eq(3).html('访客')
                                // }

                            }

                        }
                    }
                })

            }
        })
    }




    <!--数据交互-->
    $.ajax({
        type:'GET',
        url:'/sysmanager/load_project',
        success:function (e) {
            console.log('------------', e)
            if (e.errmsg == 'error') {
                $('.tishi-box').css('display','block')
                $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
            } else {

                for (var i = 0; i < e.project_list.length; i++) {
                    console.log(e.project_list[i]['project_id'])
                    var year = new Date(e.project_list[i]['create_time']).getFullYear()
                    var month = new Date(e.project_list[i]['create_time']).getMonth() + 1
                    var date = new Date(e.project_list[i]['create_time']).getDate()
                    var hour = new Date(e.project_list[i]['create_time']).getHours();
                    var min = new Date(e.project_list[i]['create_time']).getMinutes();
                    var second = new Date(e.project_list[i]['create_time']).getSeconds();
                    if (month < 10) {
                        month = '0' + month
                    }
                    if (date < 10) {
                        date = '0' + date
                    }
                    if (hour < 10) {
                        hour = '0' + hour
                    }
                    if (min < 10) {
                        min = '0' + min
                    }
                    if (second < 10) {
                        second = '0' + second
                    }

                    console.log('----', year + '-' + month + '-' + date + ' ' + hour + ':' + min + ':' + second)

                    $('.clone-box ul').clone().appendTo('.mirror-list')
                    $('.mirror-list ul').eq(i).find('li').eq(1).html(e.project_list[i]['project_name'])
                    $('.mirror-list ul').eq(i).find('li').eq(2).html(e.project_list[i]['access_level'])
                    $('.mirror-list ul').eq(i).find('li').eq(3).html(e.project_list[i]['role_name'])
                    $('.mirror-list ul').eq(i).find('li').eq(4).html(year + '-' + month + '-' + date + ' ' + hour + ':' + min + ':' + second)
                    $('.mirror-list ul').eq(i).find('p').html(e.project_list[i]['project_id'])


                    if ($('.mirror-list ul').eq(i).find('li').eq(2).html() == 'true') {
                        $('.mirror-list ul').eq(i).find('li').eq(2).html('公开')
                    } else if ($('.mirror-list ul').eq(i).find('li').eq(2).html() == 'false') {
                        $('.mirror-list ul').eq(i).find('li').eq(2).html("私有")
                    }

                    // if($('.mirror-list ul').eq(i).find('li').eq(3).html() == 'projectAdmin'){
                    //     $('.mirror-list ul').eq(i).find('li').eq(3).html('项目管理员')
                    // }else if($('.mirror-list ul').eq(i).find('li').eq(3).html() == 'developer'){
                    //     $('.mirror-list ul').eq(i).find('li').eq(3).html('开发人员')
                    // }else{
                    //     $('.mirror-list ul').eq(i).find('li').eq(3).html('访客')
                    // }


                }
                for (var j = 0; j < e.user_list.length; j++) {
                    $('#pj-manager').append("<option value=" + e.user_list[j]['name'] + ">" + e.user_list[j]['name'] + "</option>")
                }
                page(e.project_pages)
            }
        }
    })





    <!--checkbox 删除-->
    var project_id = []

    $('.check_all').on('click',function () {

        if($(this).is(':checked') == true){
            $('.delete_btn').css('visibility','visible')
            $('.mirror-list .check_each').each(function () {
                $(this).attr('checked','checked')
            })

        }else {
            $('.delete_btn').css('visibility','hidden')
            $('.mirror-list .check_each').each(function () {
                $(this).removeAttr('checked','checked')
            })


        }
    })


    $('.mirror-list').on('click','.check_each',function () {
        console.log($(":checkbox[name=subcheck]:checked").size())
        $('.check_each').each(function () {

            if($(".mirror-list :checkbox[name=subcheck]:checked").size() == 0){
                $('.delete_btn').css('visibility','hidden')
                $('.check_all').removeAttr('checked','checked')
                console.log($(":checkbox[name=subcheck]:checked").size())
            }else{
                $('.delete_btn').css('visibility','visible')

            }
        })
    })



    $('.delete_btn').on('click',function () {
        project_id = []
        $('.alert-box').css('display','block')
        $('.mirror-list .check_each').each(function () {
            if($(this).is(':checked') == true){
                project_id.push($(this).parents('li').siblings('p').html())

            }

        })


    })


    $('.alert-btn-no').on('click',function () {
        $('.alert-box').css('display','none')
    })

    $('.alert-box .alert-btn-yes').on('click',function () {
        console.log('--------------',project_id)
        $.ajax({
            type:"POST",
            url:"/sysmanager/delete_project",
            data:{"project_id":project_id},
            success:function (e) {
                console.log('delete-project',e)
                if(e.errmsg == 'ok'){
                    $('.mirror-list p').each(function () {
                        for(var i = 0; i<e.project_id.length;i++){
                            if($(this).html() == e.project_id[i]){
                                $(this).parents('ul').remove()
                            }
                        }

                    })
                    $('.delete_btn').css('visibility','hidden')
                    // $('.tishi-box').css('display','block')
                    // $('.tishi-box .alert-div-content h3').html('成功！')
                }else if(e.errmsg == 'error'){

                    $('.tishi-box').css('display','block')
                    $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
                }
                else{
                    $('.tishi-box').css('display','block')
                    $('.tishi-box .alert-div-content h3').html('删除失败！')
                }

            }
        })
        $('.alert-box').css('display','none')
    })




    //   访问项目
    $('.mirror-list').on('click','.project-name',function () {
        localStorage.setItem('project_id',$(this).parents('ul').find('p').html())
        window.location.href ='/sysmanager/img_details'
    })

    // 创建项目


    $('.tishi-box .alert-btn-yes').on('click',function () {
        if($(this).parents('.tishi-box').find('.alert-div-content h3').html() == '创建成功！'){

            $.ajax({
                type:'GET',
                url:'/sysmanager/load_project',
                success:function (e) {
                    console.log('------++------', e)
                    if (e.errmsg == 'error') {
                        $('.tishi-box').css('display','block')
                        $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
                    } else {
                        $('.mirror-list ul').remove()
                        for (var i = 0; i < e.project_list.length; i++) {
                            console.log(e.project_list[i]['project_id'])
                            var year = new Date(e.project_list[i]['create_time']).getFullYear()
                            var month = new Date(e.project_list[i]['create_time']).getMonth() + 1
                            var date = new Date(e.project_list[i]['create_time']).getDate()
                            var hour = new Date(e.project_list[i]['create_time']).getHours();
                            var min = new Date(e.project_list[i]['create_time']).getMinutes();
                            var second = new Date(e.project_list[i]['create_time']).getSeconds();
                            if (month < 10) {
                                month = '0' + month
                            }
                            if (date < 10) {
                                date = '0' + date
                            }
                            if (hour < 10) {
                                hour = '0' + hour
                            }
                            if (min < 10) {
                                min = '0' + min
                            }
                            if (second < 10) {
                                second = '0' + second
                            }

                            console.log('----', year + '-' + month + '-' + date + ' ' + hour + ':' + min + ':' + second)

                            $('.clone-box ul').clone().appendTo('.mirror-list')
                            $('.mirror-list ul').eq(i).find('li').eq(1).html(e.project_list[i]['project_name'])
                            $('.mirror-list ul').eq(i).find('li').eq(2).html(e.project_list[i]['access_level'])
                            $('.mirror-list ul').eq(i).find('li').eq(3).html(e.project_list[i]['role_name'])
                            $('.mirror-list ul').eq(i).find('li').eq(4).html(year + '-' + month + '-' + date + ' ' + hour + ':' + min + ':' + second)
                            $('.mirror-list ul').eq(i).find('p').html(e.project_list[i]['project_id'])


                            if ($('.mirror-list ul').eq(i).find('li').eq(2).html() == 'true') {
                                $('.mirror-list ul').eq(i).find('li').eq(2).html('公开')
                            } else if ($('.mirror-list ul').eq(i).find('li').eq(2).html() == 'false') {
                                $('.mirror-list ul').eq(i).find('li').eq(2).html("私有")
                            }

                            // if($('.mirror-list ul').eq(i).find('li').eq(3).html() == 'projectAdmin'){
                            //     $('.mirror-list ul').eq(i).find('li').eq(3).html('项目管理员')
                            // }else if($('.mirror-list ul').eq(i).find('li').eq(3).html() == 'developer'){
                            //     $('.mirror-list ul').eq(i).find('li').eq(3).html('开发人员')
                            // }else{
                            //     $('.mirror-list ul').eq(i).find('li').eq(3).html('访客')
                            // }

                        }
                        page(e.project_pages)

                    }
                }
            })


        }
        $('.tishi-box').hide();
    })

    $('.create-project').on('click',function () {
        $('.create-pj').css('display','block')
    })
    $('.pj-btn-no').on('click',function () {
        $('.create-pj').css('display','none')
    })
    $('.pj-div-nav a').on('click',function () {
        $('.create-pj').css('display','none')
    })

    $('#pjname').on('blur',function () {

        $.ajax({
            type:'POST',
            url:'/sysmanager/project_name',
            data:{"project_name":$(this).val()},
            success:function (e) {
                console.log('-----------+++++--',e)
                if (e.res == 1){
                    $('.name_tishi').css('display','inline-block')
                    $('.name_tishi').html('该项目已存在')
                    $('.pj-btn-yes').find('input').attr('disabled',true)
                }else if(e.res == 2){
                    $('.create-pj').css('display','none')
                    $('.tishi-box').css('display','block')
                    $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
                }
            }
        })


    })
    $('#pjname').on('focus',function () {
        $('.pj-btn-yes').find('input').attr('disabled',false)
        $('.name_tishi').css('display','none')
    })


    $('.pj-btn-yes input').on('click',function () {

        var pjname = $('#pjname').val()
        var pjaccess = '' +$('#pjaccess').is(":checked")
        var pjmanager = $('#pj-manager').val()
        console.log(pjmanager)
        if(pjname == ''){
            $('.name_tishi').css('display','inline-block')
            $('.name_tishi').html('项目名称不能为空')
        }

        else{

            $.ajax({
                type:'POST',
                url:'/sysmanager/project_name',
                data:{"project_name":$(this).val()},
                success:function (e) {
                    console.log('-----------+++++--',e)
                    if (e.res == 1){
                        $('.name_tishi').css('display','inline-block')
                        $('.name_tishi').html('该项目已存在')
                        $('.pj-btn-yes').find('input').attr('disabled',true)
                    }else if(e.res == 2){
                        $('.create-pj').css('display','none')
                        $('.tishi-box').css('display','block')
                        $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
                    }
                    else{

                        $.ajax({
                            type:'POST',
                            url:'/sysmanager/add_project',
                            data:{"project_name":pjname,"public_value":pjaccess,'name':pjmanager},
                            success:function (e) {
                                $('.create-pj').css('display','none')
                                console.log('-------------',e)
                                if(e.errmsg == 'ok'){

                                    $('.tishi-box').css('display','block')
                                    $('.tishi-box .alert-div-content h3').html('创建成功！')

                                }else if(e.errmsg == 'error'){
                                    $('.tishi-box').css('display','block')
                                    $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
                                }
                                else {
                                    $('.tishi-box').css('display','block')
                                    $('.tishi-box .alert-div-content h3').html('创建失败！')

                                }
                            }
                        })


                    }
                }
            })









        }
    })



    $('.icon-tishi').hover(function () {
        $('.tishi-info').show()
    },function () {
        $('.tishi-info').hide()
    })
</script>

{% endblock rightcontent %}

{% block bottomfile %}
<script type="text/javascript" src="{{ url_for('static', filename='laydate/laydate.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/Feffects.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.nicescroll.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='c3/d3.v3.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='c3/c3.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/public.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/paging.js') }}"></script>

{% endblock bottomfile %}
