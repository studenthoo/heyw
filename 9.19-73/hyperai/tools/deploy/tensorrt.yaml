apiVersion: extensions/v1beta1
kind: List
items:
- apiVersion: extensions/v1beta1
  kind: Deployment
  metadata:
    name: $name$
    labels:
      app: $label$
  spec:
    replicas: $replicas$
    selector:
      matchLabels:
        app: $label$
    template:
      metadata:
        labels:
          app: $label$
      spec:
        nodeSelector:
#          kubernetes.io/hostname: 10.18.95.4
        containers:
          - name: $name$
            image: $image$
            #command: ["sh","-c"]
            #args: ["/usr/sbin/sshd -D"]
            command: $cmd$
            args: $args$
            volumeMounts:
              - name: nfs-storage
                readOnly: false
                mountPath: /home/nfsdir
            ports:
              - name: restserver
                containerPort: 8000
              - name: ssh
                containerPort: 22
            resources:
              limits:
                nvidia.com/gpu: $gpu$
                #alpha.kubernetes.io/nvidia-gpu: 1
                cpu: $cpu$
                memory: $memory$
              requests:
                nvidia.com/gpu: $gpu$
                cpu: $cpu$
                memory: $memory$
        volumes:
          - name: nfs-storage
            nfs:
              server: 10.18.95.2
              path: "/home/nfsdir"

- apiVersion: v1
  kind: Service
  metadata:
    name: $name$
  spec:
    type: NodePort
    sessionAffinity: ClientIP
    selector:
      app: $label$
    ports:
      - name: restserver
        port: 31100
        nodePort: $nodePort$
        targetPort: 8000
#      - name: ssh
#        port: 31003
#        nodePort: 31002
#        targetPort: 22
