{% extends 'new/public.html' %}


{% block topfile %}
<link rel="shortcut icon" href="{{ url_for('static', filename='images/bitbug_favicon.ico') }}"/>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/public.css') }}"/>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/sub.css') }}"/>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/iconfont.css') }}"/>
<link rel="stylesheet" type="{{ url_for('static', filename='text/css" href="css/calendar.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='c3/c3.css') }}"/>
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}"/>

<link rel="stylesheet" href="{{ url_for('static', filename='data1/css/lq.datetimepick.css') }}"/>
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery-1.7.2.js') }}"></script>
<script type="text/javascript" src="{{url_for('static', filename='js/paging.js')}}" ></script>
<style>

    /*.check_all{*/
    /*margin-left: 44%;*/
    /*}*/
    @media screen and (max-width: 1450px){
        /*.check_all{*/
        /*margin-left: 41%;*/
        /*}*/
    }
    @media screen and (max-width: 1700px){
        /*.check_all{*/
        /*margin-left: 43%;*/
        /*}*/
    }


    .delete_btn{

        cursor: pointer;
        visibility: hidden;

    }
    .right-bottom{
        margin-top: 20px;
    }

    .mirror-box {
        display: block;
        width: 100%;
        min-height: 500px;
    }

    .mirror-inerbox {
        /*float: left;*/
        display: inline-block;
        width: 100%;
        margin: 0;
        padding: 0;
    }



    .m-bdr {
        border-bottom: 1px solid #d9dce1;

    }
    .mirror-list-box{
        display: block;
        width: 100%;
        min-height: 400px;
        font-family: '宋体';
    }
    .mirror-list-box ul{
        display: block;
        width: 100%;
    }
    .mirror-list-box ul li{
        display: inline-block;
        width: 28%;
        text-align: center;
    }
    .mirror-name,.mirror-list{
        display: block;
        width: 100%;
    }
    .mirror-name{
        height: 50px;
        line-height: 50px;
        color: #999;
    }
    .mirror-list ul{
        height: 40px;
        line-height: 40px;
        color: #2c3850;
    }
    .clone-box{
        display: none;
    }
    .mirror-name li:nth-child(1){
        width: 10%;
    }
    .mirror-list ul li:nth-child(1){
        width:10%;
    }
    .mirror-name span {
        display: inline-block;
        margin: 0;
        padding: 0;
        font-family: "微软雅黑";
        font-size: 14px;
        font-weight: 200;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
    }

    .w-100{
        width: 100%;
    }
    #page a {
        min-width: 30px;
        height: 28px;
        border: 1px solid #dce0e0!important;
        text-align: center;
        margin: 0 4px;
        cursor: pointer;
        line-height: 28px;
        color: #666666;
        font-size: 13px;
        display: inline-block;
        font-family: '微软雅黑';
    }
    .page_box{text-align: center}
    #page{
        display: inline-block;
    }
    #page .totalPages,#page .totalSize{display: none;}
    #page a{padding: 0 5px;margin: 0 1px;}
    #page a:hover{color: white;
        background: #00b5b8;
    }
    #page .current{background: #00b5b8;
        color:white;
    }
</style>
{% with namespace = "/jobs" %}
{% set room = "job_management" %}
{% include 'socketio.html' %}
{% endwith %}
{% endblock topfile %}

{% block rightcontent %}













<div class="f-l title">
    <h1 class="f-l c-grayblue"> 镜像仓库 </h1>
    <span class="f-l c-gray"> Welcome back, {{request.cookies.username}} </span>
</div>

<div class="f-l sub-title bgc-white">
    <a href="{{ url_for('hyperai.views.index') }}" class="f-l c-gray c-aqua-h"><span class="f-l"> Home   </span><em
            class="f-l c-gray"> / </em></a>
    <a href="{{url_for('hyperai.sysmanager.views.show')}}" class="f-l c-gray c-aqua-h"><span class="f-l"> 镜像仓库 </span><em class="f-l c-gray">
        / </em></a>
    <a href="#" class="f-l c-gray c-aqua-h"><span class="f-l"> 镜像 </span><em class="f-l c-gray">
        / </em></a>
</div>

<div class="f-l lis-d bgc-white">
    <div class="l-box pull-img">
        <a href="/sysmanager/load_local" class="f-l btn-2 bgc-Aqua c-white m-r25 bgc-red-h c-white-h btn_new_model"> 推送镜像 </a>

    </div>
    <div class="r-box">
        <input type="search" placeholder="输入需要查找的镜像名称" class="btn_select_i_text f-l c-gray input-info bdr-n bdr-b"/>
        <a href="#" class="f-l btn-3 c-gray c-red-h btn_select_i"><i class="f-l iconfont fz-24"> &#xe608; </i></a>

    </div>

</div>



<!--警告弹窗-->
<style>
    .alert-box,.create-pj,.tishi-box{    z-index: 99998;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, .6);
        display: none;
    }
    .alert-div{
        width: 400px;
        height: 240px;
        background: white;
        margin: 0 auto;
        margin-top: 10%;
        position: relative;
    }
    .pj-div{
        display: block;
        width: 400px;
        height: 400px;
        position: fixed;
        top: 20%;
        left: 55%;
        margin-left: -275px;
        z-index: 99999;
        background-color: #fff;
    }
    .alert-div-nav,.pj-div-nav{
        height:40px;
        line-height: 40px;
    }
    .pj-div-nav i{
        width: 40px;
        text-align: center;
        color: #999999;
    }
    .pj-div-nav i:hover{
        color: #ff6376;
    }
    .pj-content{
        display: block;
        width:100%;
        min-height:200px;
        padding: 20px 30px;
    }
    .pj-content label{
        display: block;
        /*width: 100%;*/
        height: 20px;
        font-family: "宋体";
        line-height: 20px;
        font-size: 14px;
        color: #000000;
        margin-bottom: 5px;
    }
    .pj-name input,.pj-access input{
        height: 30px;
        width: 100%;
        margin-bottom: 10px;
        padding: 0 5px;
    }
    .pj-access{
        margin-top: 20px;
    }





    .alert-div-content h3{height: 40px;
        line-height: 40px;
        text-align: center;
        margin-top: 35px;
    }
    .alert-btn,.pj-btn{height: 40px;
        text-align: center;
        position: absolute;
        bottom: 35px;
        width: 100%;
    }
    .alert-btn div,.pj-btn div{display: inline-block; }
    .alert-btn  h3,.pj-btn h3{
        height:40px;
        width: 100%;
        /*padding: 0 30px;*/
        line-height: 40px;
    }
    .alert-btn-no,.pj-btn-no{
        color: #2c3850;
        background: #d2e0e9;
        margin-right: 20px;
        width:100px;
    }
    .pj-btn-no{
        margin-right: 50px;
    }
    .alert-btn-yes,.pj-btn-yes{background: #00b5b8;
        color: white;
        width:100px;
    }
    .hover-red:hover{color: white;
        background: #ff6376;
    }
</style>
<div class="alert-box">
    <div class="alert-div">
        <div class="alert-div-nav">
            <!--<i class="fz-24 iconfont f-r hover-red"> &#xe676; </i>-->
        </div>
        <div class="alert-div-content">
            <h3>确认删除？</h3>
        </div>
        <div class="alert-btn">
            <div class="alert-btn-no hover-red">
                <h3>取消</h3>
            </div>
            <div class="alert-btn-yes hover-red">
                <h3>确认</h3>
            </div>
        </div>
    </div>
</div>


<div class="tishi-box">
    <div class="alert-div">
        <div class="alert-div-nav">
            <!--<i class="fz-24 iconfont f-r hover-red"> &#xe676; </i>-->
        </div>
        <div class="alert-div-content">
            <h3></h3>
        </div>
        <div class="alert-btn">

            <div class="alert-btn-yes hover-red">
                <h3>确定</h3>
            </div>
        </div>
    </div>
</div>


<div class="create-pj">
    <div class="pj-div">
        <div class="pj-div-nav">
            <a href="#"><i class=" iconfont f-r "> &#xe676; </i></a>
        </div>
        <div class="pj-content">
            <div class="pj-name">
                <label for="pjname" class="f-l">镜像名称<em style="display:inline-block;margin-left:5px;color: red">*</em></label>
                <input type="text" id="pjname" name="img_name" required="required" />
            </div>
            <div class="pj-access">
                <label for="img-label" class="f-l">标签</label>
                <input type="text" id="img-label" name="img_label" value="latest" />

            </div>
            <div class="pj-access">
                <input type="hidden" value="" name="project_id" class="pj_id"/>
            </div>
        </div>
        <div class="pj-btn">
            <div class="pj-btn-no hover-red">
                <h3>取消</h3>
            </div>
            <div class="pj-btn-yes hover-red">
                <h3>确认</h3>
            </div>
        </div>
    </div>
</div>



<!--克隆-->
<div class="clone-box">
    <ul class="f-l">
        <li class="f-l">
            <input type="checkbox" name="subcheck" class="check_each"/>
            <span class=" " style="height: 50px;line-height: 50px;margin-left: 10px;width: 20px;visibility: hidden;">
                    <i class="fz-20 iconfont"> &#xe61c; </i>
                </span>
        </li>
        <li class="f-l" style=""></li>
        <li class="f-l"></li>
        <li class="f-l"></li>
        <!--<li class="f-l"></li>-->
        <p class="f-l" style="display: none;"></p>
    </ul>

</div>



<div class="lis-c  bgc-white">
    <div class="mirror-inerbox f-l">
        <!--<div class="mirror-title f-l">
            <span class="f-l m-bdr">共享镜像</span>
            <span class="f-l">私有镜像</span>
        </div>-->
        <div class="f-l mirror-list-box">
            <div class="mirror-name f-l m-bdr">
                <ul class="f-l">
                    <li class="f-l">
                        <div style="width: 100%;height: 50px;margin-left:0px;">
                            <input type="checkbox" class="check_all" style="height: 50px;"/>
                            <span class=" delete_btn " style="height: 50px;line-height: 50px;margin-left: 10px;">
                    <i class="fz-20 iconfont"> &#xe61c; </i>
                </span>

                        </div>
                    </li>
                    <li class="f-l">镜像名称</li>
                    <li class="f-l">下载数</li>
                    <li class="f-l">更新时间</li>
                    <!--<li class="f-l">创建时间</li>-->
                </ul>
            </div>
            <div class="mirror-list f-l">

            </div>
        </div>


        <div class="w-100 page_box f-l" style="margin-top: 80px;">
            <div  id="page">

            </div>
        </div>
    </div>
</div>






<script>
    var pjid = localStorage.getItem('project_id')
    //    页码
    var page=function (a) {
        $("#page").paging({
            pageNo:1,    //显示页面
            totalPage: a,   //总页数
            totalSize: 300,
            callback: function(num) {

                console.log('---------',num)

                $.ajax({
                    type:'POST',
                    url:'/sysmanager/load_img',
                    data:{'num':num,'project_id':pjid},
                    success:function (e) {
                        console.log('-----------', e)
                        if (e.errmsg == 'error') {
                            $('.tishi-box').css('display','block')
                            $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
                        } else {
                            $('.mirror-list ul').remove()

                            for (var i = 0; i < e.img_list.length; i++) {

                                var year = new Date(e.img_list[i]['update_time']).getFullYear()
                                var month = new Date(e.img_list[i]['update_time']).getMonth() + 1
                                var date = new Date(e.img_list[i]['update_time']).getDate()
                                var hour = new Date(e.img_list[i]['update_time']).getHours();
                                var min = new Date(e.img_list[i]['update_time']).getMinutes();
                                var second = new Date(e.img_list[i]['update_time']).getSeconds();
                                if (month < 10) {
                                    month = '0' + month
                                }
                                if (date < 10) {
                                    date = '0' + date
                                }
                                if (hour < 10) {
                                    hour = '0' + hour
                                }
                                if (min < 10) {
                                    min = '0' + min
                                }
                                if (second < 10) {
                                    second = '0' + second
                                }

                                $('.clone-box ul').clone().appendTo('.mirror-list')
                                $('.mirror-list ul').eq(i).find('li').eq(1).html(e.img_list[i]['re_name'])
                                $('.mirror-list ul').eq(i).find('li').eq(2).html(e.img_list[i]['pull_count'])
                                $('.mirror-list ul').eq(i).find('li').eq(3).html(year + '-' + month + '-' + date + ' ' + hour + ':' + min + ':' + second)
                                $('.mirror-list ul').eq(i).find('p').html(e.img_list[i]['repository_id'])


                            }

                        }
                    }
                })

            }
        })
    }







    <!--数据交互-->
    console.log(typeof (localStorage.getItem('project_id')))

    $.ajax({
        type:'POST',
        url:'/sysmanager/load_img',
        data:{'project_id': pjid},
        success:function (e) {
            console.log('------------', e)
            if (e.errmsg == 'error') {
                $('.tishi-box').css('display','block')
                $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
            } else {
                $('.pj_id').val(localStorage.getItem('project_id'))
                for (var i = 0; i < e.img_list.length; i++) {

                    var year = new Date(e.img_list[i]['update_time']).getFullYear()
                    var month = new Date(e.img_list[i]['update_time']).getMonth() + 1
                    var date = new Date(e.img_list[i]['update_time']).getDate()
                    var hour = new Date(e.img_list[i]['update_time']).getHours();
                    var min = new Date(e.img_list[i]['update_time']).getMinutes();
                    var second = new Date(e.img_list[i]['update_time']).getSeconds();
                    if (month < 10) {
                        month = '0' + month
                    }
                    if (date < 10) {
                        date = '0' + date
                    }
                    if (hour < 10) {
                        hour = '0' + hour
                    }
                    if (min < 10) {
                        min = '0' + min
                    }
                    if (second < 10) {
                        second = '0' + second
                    }


                    $('.clone-box ul').clone().appendTo('.mirror-list')
                    $('.mirror-list ul').eq(i).find('li').eq(1).html(e.img_list[i]['re_name'])
                    $('.mirror-list ul').eq(i).find('li').eq(2).html(e.img_list[i]['pull_count'])
                    $('.mirror-list ul').eq(i).find('li').eq(3).html(year + '-' + month + '-' + date + ' ' + hour + ':' + min + ':' + second)
                    $('.mirror-list ul').eq(i).find('p').html(e.img_list[i]['repository_id'])


                }
                page(e.img_pages)
            }
        }
    })





    <!--checkbox 删除-->
    var img_id = []

    $('.check_all').on('click',function () {

        if($(this).is(':checked') == true){
            $('.delete_btn').css('visibility','visible')
            $('.mirror-list .check_each').each(function () {
                $(this).attr('checked','checked')
            })

        }else {
            $('.delete_btn').css('visibility','hidden')
            $('.mirror-list .check_each').each(function () {
                $(this).removeAttr('checked','checked')
            })


        }
    })


    $('.mirror-list').on('click','.check_each',function () {
        console.log($(":checkbox[name=subcheck]:checked").size())
        $('.check_each').each(function () {

            if($(".mirror-list :checkbox[name=subcheck]:checked").size() == 0){
                $('.delete_btn').css('visibility','hidden')
                $('.check_all').removeAttr('checked','checked')
                console.log($(":checkbox[name=subcheck]:checked").size())
            }else{
                $('.delete_btn').css('visibility','visible')

            }
        })
    })



    $('.delete_btn').on('click',function () {
        img_id = []
        $('.alert-box').css('display','block')
        $('.mirror-list .check_each').each(function () {
            if($(this).is(':checked') == true){
                img_id.push($(this).parents('li').siblings('p').html())

            }

        })

        console.log(img_id)
    })


    $('.alert-btn-no').on('click',function () {
        $('.alert-box').css('display','none')
    })

    $('.alert-box .alert-btn-yes').on('click',function () {
        console.log('----',img_id)
        $.ajax({
            type:"POST",
            url:"/sysmanager/delete_img",
            data:{"repository_id":img_id},
            success:function (e) {
                console.log('-----',e)
                $('.alert-box').css('display','none')
                if(e.errmsg == 'ok'){
                    $('.mirror-list p').each(function () {
                        for(var i = 0; i<e.repository_id.length;i++){
                            if($(this).html() == e.repository_id[i]){
                                $(this).parents('ul').remove()
                            }
                        }

                    })
                    $('.delete_btn').css('visibility','hidden')
                    // $('.tishi-box').css('display','block')
                    // $('.tishi-box .alert-div-content h3').html('成功！')
                }else if(e.errmsg == 'error'){

                    $('.tishi-box').css('display','block')
                    $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
                }
                else{
                    $('.tishi-box').css('display','block')
                    $('.tishi-box .alert-div-content h3').html('删除失败！')
                }

            }
        })

    })


    // $('.pull-img').on('click',function () {
    //     $('.create-pj').css('display','block')
    // })
    //     $('.pj-btn-no').on('click',function () {
    //         $('.create-pj').css('display','none')
    //     })
    //     $('.pj-div-nav').on('click',function () {
    //         $('.create-pj').css('display','none')
    //     })




    // $('.pj-btn-yes').on('click',function () {
    //     console.log('*********',$('#pjname').val(),$('#img-label').val(),$('.pj_id').val())
    //     $.ajax({
    //         type:"POST",
    //         url:'/sysmanager/push_img',
    //         data:{'img_name':$('#pjname').val(),'img_tag':$('#img-label').val(),'project_id':$('.pj_id').val()},
    //         success:function (e) {
    //          console.log('**********',e)
    //             $('.create-pj').css('display','none')
    //
    //                 $('.tishi-box').css('display','block')
    //                 $('.tishi-box .alert-div-content h3').html(e.errmsg)
    //
    //         }
    //     })
    // })

    // $('.tishi-box .alert-btn-yes').on('click',function () {
    //     if($(this).parents('.tishi-box').find('.alert-div-content h3').html() == '镜像上传成功！'){
    //         $.ajax({
    //             type:'POST',
    //             url:'/sysmanager/load_img',
    //             data:{'project_id': pjid},
    //             success:function (e) {
    //                 console.log('------------',e)
    //                 $('.pj_id').val(localStorage.getItem('project_id'))
    //                 $('.mirror-list ul').remove()
    //                 for (var i = 0;i<e.img_list.length;i++){
    //
    //                     var year = new Date(e.img_list[i]['update_time']).getFullYear()
    //                     var month = new Date(e.img_list[i]['update_time']).getMonth()+1
    //                     var date = new Date(e.img_list[i]['update_time']).getDate()
    //                     var hour = new Date(e.img_list[i]['update_time']).getHours();
    //                     var min = new Date(e.img_list[i]['update_time']).getMinutes();
    //                     var second = new Date(e.img_list[i]['update_time']).getSeconds();
    //                     if(month < 10){
    //                         month = '0' + month
    //                     }
    //                     if(date <10){
    //                         date = '0'+date
    //                     }
    //                     if(hour < 10){
    //                         hour = '0' + hour
    //                     }
    //                     if(min < 10){
    //                         min = '0' + min
    //                     }
    //                     if(second < 10){
    //                         second = '0' + second
    //                     }
    //
    //
    //
    //                     $('.clone-box ul').clone().appendTo('.mirror-list')
    //                     $('.mirror-list ul').eq(i).find('li').eq(1).html(e.img_list[i]['re_name'])
    //                     $('.mirror-list ul').eq(i).find('li').eq(2).html(e.img_list[i]['pull_count'])
    //                     $('.mirror-list ul').eq(i).find('li').eq(3).html(year+'-'+month+'-'+date+' '+hour+':'+min+':'+second)
    //                     $('.mirror-list ul').eq(i).find('p').html(e.img_list[i]['repository_id'])
    //
    //
    //
    //                 }
    //                 page(e.img_pages)
    //             }
    //         })
    //
    //
    //
    //     }
    //     $('.tishi-box').hide();
    // })



    //查询
    $('.btn_select_i').on('click',function () {
        $.ajax({
            type:'POST',
            url:'/sysmanager/load_img',
            data:{'name':$('.btn_select_i_text').val(),'project_id':pjid},
            success:function (e) {
                console.log('------search------', e)
                if (e.errmsg == 'error') {
                    $('.tishi-box').css('display','block')
                    $('.tishi-box .alert-div-content h3').html('镜像仓库连接失败！')
                } else {
                    $('.mirror-list ul').remove()

                    for (var i = 0; i < e.img_list.length; i++) {

                        var year = new Date(e.img_list[i]['update_time']).getFullYear()
                        var month = new Date(e.img_list[i]['update_time']).getMonth() + 1
                        var date = new Date(e.img_list[i]['update_time']).getDate()
                        var hour = new Date(e.img_list[i]['update_time']).getHours();
                        var min = new Date(e.img_list[i]['update_time']).getMinutes();
                        var second = new Date(e.img_list[i]['update_time']).getSeconds();
                        if (month < 10) {
                            month = '0' + month
                        }
                        if (date < 10) {
                            date = '0' + date
                        }
                        if (hour < 10) {
                            hour = '0' + hour
                        }
                        if (min < 10) {
                            min = '0' + min
                        }
                        if (second < 10) {
                            second = '0' + second
                        }

                        $('.clone-box ul').clone().appendTo('.mirror-list')
                        $('.mirror-list ul').eq(i).find('li').eq(1).html(e.img_list[i]['re_name'])
                        $('.mirror-list ul').eq(i).find('li').eq(2).html(e.img_list[i]['pull_count'])
                        $('.mirror-list ul').eq(i).find('li').eq(3).html(year + '-' + month + '-' + date + ' ' + hour + ':' + min + ':' + second)
                        $('.mirror-list ul').eq(i).find('p').html(e.img_list[i]['repository_id'])


                    }
                    page(e.img_pages)
                }
            }
        })
    })


</script>

{% endblock rightcontent %}

{% block bottomfile %}
<script type="text/javascript" src="{{ url_for('static', filename='laydate/laydate.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/Feffects.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.nicescroll.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='c3/d3.v3.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='c3/c3.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/public.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/paging.js') }}"></script>

{% endblock bottomfile %}
