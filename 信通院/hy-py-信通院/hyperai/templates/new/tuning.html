{% extends 'new/public.html' %}

<title>{% block title %}
中科弘云
{% endblock title %}</title>
{% block topfile %}
		<link rel="shortcut icon" href="{{url_for('static', filename='images/bitbug_favicon.ico')}}" />
		<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/iconfont.css')}}" />
		<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/public.css')}}" />
		<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/sub.css')}}" />
		<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/tuning.css')}}" />
		<!--<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/autocomplete.css')}}" />-->
		<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/style.css')}}" />
		<script src="{{ url_for('static', filename='js/jquery-1.7.2.js') }}" type="text/javascript" charset="utf-8"></script>
		<script src="{{ url_for('static', filename='js/jquery.nicescroll.js') }}" type="text/javascript" charset="utf-8"></script>
		<script src="{{ url_for('static', filename='js/t-pub.js') }}" type="text/javascript" charset="utf-8"></script>
		<script src="{{url_for('static', filename='js/3rdparty/jquery.autocomplete-1.2.21.min.js')}}" type="text/javascript" charset="utf-8"></script>
{% endblock topfile%}
{% block rightcontent %}


<!--提示框-->
<style>
	.prompt-box,.alert-box{    z-index: 99998;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0, 0, 0, .6);
		display: none;
	}
	.alert-div{
		width: 400px;
		height: 240px;
		background: white;
		margin: 0 auto;
		margin-top: 10%;
		position: relative;
	}
	.alert-div-nav{
		height:40px;
	}

	.alert-div-content h3{height: 40px;
		line-height: 40px;
		text-align: center;
		margin-top: 35px;
	}
	.alert-btn{height: 40px;
		text-align: center;
		position: absolute;
		bottom: 35px;
		width: 100%;
	}
	.alert-btn div{display: inline-block; }
	.alert-btn  h3{
		height:40px;
		width: 100%;
		/*padding: 0 30px;*/
		line-height: 40px;
	}

	.alert-btn-yes{background: #00b5b8;
		color: white;
		width:100px;
	}
	.hover-red:hover{color: white;
		background: #ff6376;
	}
</style>

<div class="prompt-box">
	<div class="alert-div">
		<div class="alert-div-nav">

		</div>
		<div class="alert-div-content">
			<h3 ></h3>
		</div>
		<div class="alert-btn">

			<div class="alert-btn-yes hover-red">
				<h3>确定</h3>
			</div>
		</div>
	</div>
</div>
<script>
	$('.prompt-box .alert-btn-yes').on('click',function () {
		$('.prompt-box').css('display','none')
	})

    $(".xitong-h1").toggle(function() {
        $(this).addClass('current-la').siblings().removeClass('current-la')
        $(this).next(".side-div").slideDown(500)

    }, function() {
        $(this).removeClass('current-la')
        $(this).next(".side-div").slideUp(500)
    });
</script>



			<div class="f-l title">
				<h1 class="f-l c-grayblue"> 超参调优</h1>
				<span class="f-l c-gray"> Welcome back, {{request.cookies.username}} </span>
			</div>
			<div class="f-l sub-title bgc-white">
				<a href="index.html" class="f-l c-gray c-aqua-h"><span class="f-l"> Home</span><em class="f-l c-gray"> / </em></a>
				<a href="#" class="f-l c-gray c-aqua-h"><span class="f-l">调优训练</span><em class="f-l c-gray"> / </em></a>
			</div>
		<form action="{{url_for('hyperai.tuning.views.get_data')}}" method="post" class="f-l" enctype="multipart/form-data" >
				<div class="tuning-box f-l">
					<div class="tuning-model f-l" style="padding-top: 20px;">
						<div class="f-l model-text">
							<h3>作业名称</h3>
							<div style="display: block;float: left;">
								<!--<input type="text" name="homeworkname" value="" class=" upload-ser"  placeholder=''/>-->
                                {{form.homework_name(class="upload-ser bdr")}}


							</div>
						</div>
					</div>
					<div class="title f-l">
						<h1 class="f-l c-grayblue">模型</h1>
					</div>
					<div class="tuning-model f-l">
						<div class="f-l model-text">
							<style>
								.model-text .file-lis{
									display: inline-block;
									width: 20rem;
									height: 38px;
									padding: 0 10px;
									border: none;
									border: 1px solid #D9DCE1;
								}
							</style>
								<h3>从本地上传文件</h3>
								<div style="display: block;float: left;">
									<input type="text" name="" id="" value="" class="file-lis bdr"/>
									<a href="#" class="upload-file f-r" >
										<!--<input type="file" name="model_files" id="" value="" class="codefile" /> 浏览-->
                                        {{form.model_file(class="codefile")}}
									</a>
								</div>
						</div>
						<!--<div class="f-l model-text" style="color: #999">or</div>-->
						<div class="f-l model-text">
							<style>
								.upload-ser{
									width: 28rem;
									height: 38px;
									border: 1px solid #d9dce1;
									padding: 0 10px;
								}
								.
							</style>
								<h3>服务器端路径</h3>
								<!--<input type="text" name="" value="" class="autocomplete_path upload-ser"  placeholder='folder or URL'/>-->
                                {{form.model_path(class="autocomplete_path upload-ser bdr", placeholder='folder or URL')}}
						</div>
					</div>
					<hr />
					<div class="title f-l">
						<h1 class="f-l c-grayblue">数据集</h1>
					</div>
					<div class="tuning-model f-l">
						<div class="f-l model-text">
							<h3>选择数据集</h3>
							<!--<input type="text" name="dataset_file" value="" class="autocomplete_path upload-ser"  placeholder='folder or URL'/>-->
                            {{form.dataset_file(class="autocomplete_path upload-ser bdr", placeholder='folder or URL')}}
						</div>
					</div>
				</div>
				<div class="tuning-box f-l">
					<div class="title f-l">
						<h1 class="f-l c-grayblue">参数区</h1>
					</div>
					<div class="tuning-model f-l">
						<div class="model-text f-l" style="margin-bottom: 50px;">
							<h3>优化方式</h3>
							<div class="div-input f-l">
                                {{form.optimize_type(class="bdr t-way")}}
							</div>
							<h3>优化方法</h3>
							<div class="div-input f-l ">
                                {{form.Bayesian_method(class="bdr t-fun1")}}
                                {{form.optimize_method(class="bdr t-fun2")}}
							</div>
						</div>
						<div class="model-text f-l bys-par">
							<h3>bayesian迭代次数</h3>
							<span class="dis-1 dis-span">
								迭代次数选择1到100之间
							</span>
							<div class="div-input f-l">
                                {{form.bayesion_iteration(class="bdr")}}
							</div>
							<h3>模型迭代次数</h3>
							<span class="dis-2 dis-span">
								模型迭代次数选择1到100之间
							</span>
							<div class="div-input f-l">
                                {{form.model_iteration(class="bdr")}}
							</div>
						</div>
						<div class="model-text f-l bys-par">
							<h3>batch-size</h3>
							<span class="dis-3 dis-span">
								batch-size可以选1到128的整数
							</span>
							<div class="div-input f-l 	">
                                {{form.batch_size(class="bdr")}}
							</div>
						</div>
						<div class="model-text f-l pbt-par" style="position: relative;">
							<h3>迭代次数</h3>
							<span class="dis-1 dis-span">
								迭代次数选择1到100之间
							</span>
							<div class="div-input f-l ">
								<input type="text" name="epoch" id="" value="10" class="bdr" placeholder=""/>
							</div>
							<h3>Work数量</h3>
							<span class="dis-2 dis-span">
								Worker数量可以选择2到45的整数
							</span>
							<div class="div-input f-l">
								<input type="text" name="worker_number" id="" value="15" class="bdr" placeholder=""/>
							</div>
						</div>
						<div class="model-text f-l pbt-par">
							<h3>batch-size</h3>
							<span class="dis-3 dis-span">
								batch-size可以选1到128的整数
							</span>
							<div class="div-input f-l">
								<input type="text" name="batch_size1" id="" value="64" class="bdr" placeholder=""/>
							</div>
							<h3>exploit_interval</h3>
							<span class="dis-4 dis-span">
								exploit_interval可选0.5到2
							</span>
							<div class="div-input f-l">
								<input type="text" name="exploit_interval" id="" value="0.5" class="bdr" placeholder=""/>
							</div>
						</div>
						<div class="f-l t-box1-all" style="width: 100%;">
						<style>
							.w-25{
								width: 25%;
							}
							@media screen and (max-width: 1245px){
								.w-25{
									width:23%;
								}
							}
						</style>
						<div class="c-box t-box1" style="padding-left: 10px">
							<div class="l-box w-20 ml-2 ta-c ">
								<h4 class="f-l c-grayblue">学习率(lr)</h4>
								<span class="dis-span cp-1 ">
									学习率的范围是（0.00001,1）
								</span>
								<input type="checkbox" name="optional_para" id="checkone" value="" class="f-l check " style="margin-top: 15px"/>
                                {{form.lr_lower(class="f-l input-info bdr w-25 study")}}
								<em class="f-l" style="margin: 5px">~</em>
                                {{form.lr_up(class="f-l input-info bdr w-25 study")}}
								<input type="hidden" value="" name="lr"/>
							</div>
							<div class="l-box w-20 ml-2 ta-c ">
								<h4 class="f-l c-grayblue" >动量(momentum)</h4>
								<span class="dis-span cp-1 ">
									动量的范围是（0.1,0.9999）
								</span>
								<input type="checkbox" name="optional_para" id="checktwo" value="" class="f-l check" style="margin-top: 15px"/>
                                {{form.momentum_lower(class="input-info bdr w-25 f-l")}}
								<em class="f-l" style="margin: 5px">~</em>
                                {{form.momentum_up(class="input-info bdr w-25 f-l")}}
								<input type="hidden" value="" name="momentum"/>
							</div>
							<div class="l-box w-20 ml-2 ta-c ">
								<h4 class="f-l c-grayblue" >梯度衰减因子(decay)</h4>
								<span class="dis-span cp-1 ">
									梯度衰减因子的范围是（0.00001,1）
								</span>
								<input type="checkbox" name="optional_para" id="checkthree" value="" class="check f-l" style="margin-top: 15px"/>
                                {{form.decay_lower(class="input-info bdr w-25 f-l")}}
								<em class="f-l" style="margin: 5px">~</em>
                                {{form.decay_up(class="input-info bdr w-25 f-l")}}
								<input type="hidden" value="" name="decay"/>
							</div>
							<div class="l-box w-20 ml-2 ta-c ">
								<h4 class="f-l c-grayblue">指数衰减率1(beta1)</h4>
								<span class="dis-span cp-1 ">
									指数衰减率1的范围是（0.00001,1）
								</span>
								<input type="checkbox" name="optional_para" id="checkfour" value="" class="check f-l" style="margin-top: 15px"/>
                                {{form.beta1_lower(class="input-info bdr w-25 f-l")}}
								<em class="f-l" style="margin: 5px">~</em>
                                {{form.beta1_up(class="input-info bdr w-25 f-l")}}
							</div>
							<div class="l-box w-20 ml-2 ta-c ">
								<h4 class="f-l c-grayblue" >指数衰减率2(beta2)</h4>
								<span class="dis-span cp-1 ">
									指数衰减率2的范围是（0.00001,1）
								</span>
								<input type="checkbox" name="optional_para" id="checkfive" value="" class="check f-l" style="margin-top: 15px"/>
                                {{form.beta2_lower(class="input-info bdr w-25 f-l")}}
								<em class="f-l" style="margin: 5px">~</em>
                                {{form.beta2_up(class="input-info bdr w-25 f-l")}}
								<input type="hidden" value="" name="beta2"/>
							</div>
						</div>

						</div>
						<div class="c-box t-box2">
							<div class="l-box w-20 ml-2 ta-c">
								<h4 class="f-l c-grayblue">学习率(lr) </h4>
								<span class="dis-span cp-1 ">
									学习率的范围是（0.00001,1）
								</span>
								<input type="text" name="learning_rate" id="" value="0.0001" class=" input-info bdr w-70" />
							</div>
							<div class="l-box w-20 ml-2 ta-c">
								<h4 class="f-l c-grayblue"> 动量(momentum)</h4>
								<span class="dis-span cp-1 ">
									动量可以选（0.1,0.9999）
								</span>
								<input type="text" name="momentum"  class=" input-info bdr w-70" value="0"/>

							</div>
							<div class="l-box w-20 ml-2 ta-c">
								<h4 class="f-l c-grayblue"> 权重衰减(weight decay)</h4>
								<span class="dis-span cp-1 ">
									权重衰减可以选（0.0001,0.0002）
								</span>
								<input type="text" name="weight_decay" class=" input-info bdr w-70" value="0"/>
							</div>
							<div class="l-box w-20 ml-2 ta-c">
								<h4 class="f-l c-grayblue"> 动量衰减（dampening） </h4>
								<span class="dis-span cp-1 ">
									动量衰减可以选（0.0001,0.0002）
								</span>
								<input type="text" name="dampening" class=" input-info bdr w-70" value="0"/>
							</div>

						</div>
							<style>
							.resour-box{
								width: 100%;
							}
							.box1{
								width: 30%;
								/*margin: 20px 0 0 10px;*/
							}
							.sel-box{
								padding: 30px 0;
							}
							.box1 h3{
								display: inline-block;
								height: 40px;
								width: 80px;
								line-height: 40px;
								font-family: "宋体";
								font-size: 14px;
								font-weight: 200;
								text-align: right;
								white-space: nowrap;
								overflow: hidden;
								margin-right: 1%;
								overflow: inherit !important;
								text-align: left;
								padding-left: 17px;
							}
							.box1 select{
								width: 50%;
								height: 40px;
								outline: none;
								border: 1px solid #D9DCE1;
								padding: 0 5px;
							}


							.resour {
								display: block;
								width: 100%;
								line-height: 50px;
								padding: 0 20px;
								/* margin: 100px 0 10px 20px; */
								font-size: 14px;
							}
							.resour h4{
								width: 90%;
								text-align: left;
								color:#2c3850;
							}
							.sel-box{
								display: block;
								width: 100%;
								border: 1px solid #D9DCE1;
								margin-bottom: 40px;
							}
						</style>
						<style>
							.check_box{
								width: 45%;
								text-align: left;
								height: 30px;
								line-height: 30px;
								color: #2c3850;
								font-size: 14px;
							}
							.res-name,.discrip-info{
								display: inline-block;
								height: 30px;
								line-height: 30px;
								margin-left: 20px;

								font-family: '宋体';
							}
							.res-name{
								margin-left: 5px;
							}
							/*#test input{*/
							/*display: inline-block;*/
							/*width: 20px;*/
							/*height: 15px;*/

							/*}*/
							.clone-box{
								display: none;
							}
						</style>
						<div class="f-l resour-box">
							<div class="model-text f-l" style="margin-bottom: 0px;">
								<h3 class=" ">选择资源池</h3>
							</div>
							<div class="sel-box f-l" id="test" style="padding: 20px 10px;">
								{% for subfield in form.node_label_choice %}
								<div class="check_box f-l">
									<tr>
										<td>{{ subfield }}</td>
										<td>{{ subfield.label }}</td>
										<td><span class="discrip-info"></span></td>
									</tr>
								</div>
								{% endfor %}
							</div>
						</div>
						<script>
                            var gpu_num = "{{ usable_label_gpu_count }}"
                            var gpu1 =gpu_num.substr(0,gpu_num.length-1)
                            var gpu2 = gpu1.substr(1)
                            // var s = gpu_num.split(', ')
                            console.log('*****-----*****', gpu2)
                            var arr_gpu = gpu2.split(', ')
                            $('#test .discrip-info').each(function (e) {
                                console.log('---',e)
                                for (var i = 0; i < arr_gpu.length; i++){
                                    if(e == i){
                                        console.log('-----------------------------')
                                        $(this).html('目前可用GPU：'+arr_gpu[i])
                                    }
                                }
                            })
						</script>
						<div class="f-l resour-box">

							<div class="model-text f-l" style="margin-bottom: 0px;">
								<h3 class=" ">资源配置</h3>
							</div>
								<div class="sel-box f-l t-box1">
									<div class="box1 f-l">
										<h3 class="f-l ">CPU(Core)</h3>
                                        {{form.cpu_count(class="f-l")}}
									</div>
									<div class="box1 f-l">
										<h3 class="f-l c-grayblue">内存(GB)</h3>
                                        {{form.memory_count(class="f-l")}}
									</div>
									<div class="box1 f-l">
										<h3 class="f-l c-grayblue">GPU数量</h3>
                                        {{form.gpu_count(class="f-l")}}
									</div>
									<div class="resour f-l">
									</div>
								</div>
						</div>


						<style>
							.model-param{
								display: none;
								margin-top: 50px;
							}
							.tuning-model .run_num_prompt{
								color: red;
								margin-left: 5px;
								font-size: 14px;
								height: 40px;
								line-height: 40px;
								display: none;
							}
						</style>

					</div>
				</div>
				<div class="tuning-sub f-l">
					<input type="reset" name="" id="" value="重置" class="f-l btn-8 m-r15 c-grayblue bgc-gray-b " />
					<input type="button" name="" id="" value="开始训练" class="f-l btn-8 m-r15 c-grayblue" />
				</div>
			</form>
<style>
</style>
<div class="alert-box">
	<div class="alert-div">
		<div class="alert-div-nav">
		</div>
		<div class="alert-div-content">
			<h3 style="font-size: 18px;"></h3>
		</div>
		<div class="alert-btn">

			<div class="alert-btn-yes hover-red">
				<h3>确定</h3>
			</div>
		</div>
	</div>
</div>
{% endblock rightcontent %}

{% block bottomfile %}
<script src="{{ url_for('static', filename='js/tuning.js', ver=dir_hash) }}" type="text/javascript" charset="utf-8"></script>
<script src="{{ url_for('static', filename='js/tuning-loc.js', ver=dir_hash) }}" type="text/javascript" charset="utf-8"></script>
<script>
	window.onload = function () {
		$('.autocomplete_path').autocomplete({
			serviceUrl: '/autocomplete/path',
			formatResult: function (suggestion, currentValue)
			{
				function baseName(str)
				{
					var base = new String(str).substring(str.lastIndexOf('/') + 1);
					return base;
				}
				return baseName(suggestion.value);
			},
			minChars: 0
		});
		$(".autocomplete_path").removeAttr("autocomplete");
	};
</script>
{% endblock bottomfile %}
